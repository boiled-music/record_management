<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>서고관리 시스템 - 보유 문서 목록</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
</head>
<body>

    <!-- ✅ 네비게이션 바 -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">서고관리 시스템</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" href="/documents">보유목록 관리</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">대출/반납 관리</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">평가/폐기 관리</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">검색/활용</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">로그</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">통계</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h1 class="text-center">📄 보유 문서 목록</h1>

        <!-- ✅ 검색 폼 -->
        <form method="GET" action="/documents" class="row g-3 mb-4">
            <div class="col-md-2">
                <input type="text" name="management_number" class="form-control" placeholder="서고관리 번호" value="{{ request.args.get('management_number', '') }}">
            </div>
            <div class="col-md-2">
                <input type="text" name="production_department" class="form-control" placeholder="생산부서" value="{{ request.args.get('production_department', '') }}">
            </div>
            <div class="col-md-2">
                <input type="number" name="start_year" class="form-control" placeholder="생산년도(시작)" value="{{ request.args.get('start_year', '') }}">
            </div>
            <div class="col-md-2">
                <input type="number" name="end_year" class="form-control" placeholder="생산년도(종료)" value="{{ request.args.get('end_year', '') }}">
            </div>
            <div class="col-md-2">
                <input type="text" name="folder_title" class="form-control" placeholder="기록물철 제목" value="{{ request.args.get('folder_title', '') }}">
            </div>
            <div class="col-md-2">
                <select name="preservation_period" class="form-select">
                    <option value="">보존기간 선택</option>
                    <option value="30년">영구</option>
                    <option value="30년">준영구</option>
                    <option value="30년">30년</option>
                    <option value="10년">10년</option>
                    <option value="5년">5년</option>
                    <option value="3년">3년</option>
                    <option value="1년">1년</option>
                </select>
            </div>
            <div class="col-md-2">
                <select name="document_type" class="form-select">
                    <option value="">형태 선택</option>
                    <option value="문서">문서</option>
                    <option value="30년">대장</option>
                    <option value="30년">카드</option>
                    <option value="도면">도면</option>
                    <option value="사진">시청각</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">검색</button>
            </div>
        </form>

        <!-- ✅ CSV 다운로드 버튼 -->
        <div class="mb-3 text-end">
            <a href="/download_csv" class="btn btn-success">CSV 다운로드</a>
        </div>

        <!-- ✅ 페이지당 표시 개수 선택 -->
        <form method="GET" action="/documents" class="mb-3 d-flex align-items-center">
            <label for="per_page" class="me-2">페이지당 항목 수:</label>
            <select name="per_page" onchange="this.form.submit()" class="form-select w-auto">
                {% for size in [10, 20, 30, 50, 100, 500, 1000] %}
                    <option value="{{ size }}" {% if per_page == size %}selected{% endif %}>{{ size }}</option>
                {% endfor %}
            </select>
        </form>

        <!-- ✅ 문서 목록 테이블 -->
        <table class="table table-bordered table-striped text-center">
            <thead>
                <tr>
                    <th><a href="?sort_by=id&sort_order={{ 'desc' if sort_order == 'asc' else 'asc' }}">연번 ⬍</a></th>
                    <th>관리번호</th>
                    <th>현재기관명</th>
                    <th>생산부서</th>
                    <th>생산년도</th>
                    <th>기록물철 제목</th>
                    <th>보존기간</th>
                    <th>형태</th>
                    <th>수량</th>
                </tr>
            </thead>
            <tbody>
                {% for doc in documents %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ doc.management_number }}</td>
                    <td>{{ doc.current_institution }}</td>
                    <td>{{ doc.production_department }}</td>
                    <td>{{ doc.production_year }}</td>
                    <td>{{ doc.folder_title }}</td>
                    <td>{{ doc.preservation_period }}</td>
                    <td>{{ doc.document_type }}</td>
                    <td>{{ doc.quantity }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- ✅ 페이지네이션 -->
        <nav>
            <ul class="pagination justify-content-center">
                {% if current_page > 1 %}
                    <li class="page-item"><a class="page-link" href="?page={{ current_page - 1 }}">&laquo; 이전</a></li>
                {% endif %}

                {% for page_num in range(1, total_pages + 1) %}
                    <li class="page-item {% if page_num == current_page %}active{% endif %}">
                        <a class="page-link" href="?page={{ page_num }}&per_page={{ per_page }}">{{ page_num }}</a>
                    </li>
                {% endfor %}

                {% if current_page < total_pages %}
                    <li class="page-item"><a class="page-link" href="?page={{ current_page + 1 }}">다음 &raquo;</a></li>
                {% endif %}
            </ul>
        </nav>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
